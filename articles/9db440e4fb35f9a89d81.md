---
title: "kurenaif Valentine Problems - redundant_rsa"
emoji: "ðŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CTF", "Crypto", "Easy"]
published: true
---

kurenaifã•ã‚“ãŒCryptoã®å•é¡Œã‚’ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã—ã¦ãã‚Œã¾ã—ãŸã€‚ã¡ã‚‡ã£ã¨å¿™ã—ã‹ã£ãŸã®ã§ä»Šã‹ã‚‰è§£ãã¾ã™ã€‚ä¸€å¿œæ—¢ã«å…¬å¼writeupãŒå‡ºã¦ã„ã‚‹ã¯ãšã§ã™ã®ã§ã€ãã¡ã‚‰ã‚’è¦‹ãŸæ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„èª¬ã‚‚ã€‚
## å•é¡Œæ¦‚è¦

[å•é¡Œãƒªãƒ³ã‚¯](https://github.com/kurenaif/kurenaif_valentine_problems/tree/main/redundant_rsa)

```python:problem.py
from Crypto.Util.number import *
from flag import *
import secrets


leftDummy = secrets.token_bytes((500 - bytes_to_long(flag).bit_length()) // 8 // 2)
rightDummy = secrets.token_bytes((500 - bytes_to_long(flag).bit_length()) // 8 // 2)

# format: RANDOM_DATAkurenaifCTF{*}RANDOM_DATA
# please Extract kurenaifCTF{*} by manual work :)
m = bytes_to_long(leftDummy + flag + rightDummy)


p = getPrime(256)
q = getPrime(256)
N = p*q

# guarantee and hint 
assert GCD(m*m % N, N) == 1
assert GCD(m*m*m % N, N) == 1

# In CTF, 3 is sometimes used, but in general RSA, 65537 is used.
print("N =", N)
print("c3 =", pow(m, 3, N))
print("c65537 =", pow(m, 65537, N))
```

## å•é¡Œè§£èª¬
RSAã®è§£èª¬ã«ã¤ã„ã¦ã¯[p_p_rsa](/articles/ff4240ae80789a0dce00)ã®æ–¹ã§æ¸ˆã¾ã›ãŸã®ã§ã€å•é¡Œã®æ–¹ã«æ—©é€Ÿè¡Œãã¾ã™ã€‚

### ç€çœ¼ç‚¹
ãƒ—ãƒ­ã‚°ãƒ©ãƒ è‡ªä½“ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã€$\gcd(m^2\%N, N) = \gcd(m^3\%N, N) = 1$ãŒä¿è¨¼ã•ã‚ŒãŸçŠ¶æ…‹ã§$m^3$ã¨$m^{65537}$ãŒä¸Žãˆã‚‰ã‚Œã¾ã™ã€‚æ°—ã«ã™ã¹ãã¯å¾Œè€…ã®ã€Œ$c$ãŒè¤‡æ•°ä¸Žãˆã‚‰ã‚Œã¦ã„ã‚‹ã€ã¨ã„ã†ç‚¹ã§ã™ã€‚

ã¨ã“ã‚ã§ã€$65537 = 3 * 21845 + 2$ã§ã™ã€‚ã¨ã„ã†ã“ã¨ã¯$c_{65535}={c_{3}}^{21845}$ã¨ã—ã¦$c_2=c_{65537}\times {c_{65535}}^{-1}$ã§ã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚åŒæ§˜ã®è€ƒãˆæ–¹ã§$m=c_3\times{c_2}^{-1}$ã§ã™ã­ã€‚

ã“ã‚Œã ã‘ãªã‚“ã§ã™ãŒã€å®Ÿéš›ã«è¨ˆç®—ã™ã‚‹éš›ã«ãŠã„ã¦ã¯$\mod N$ã§è¨ˆç®—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚$c_65535$ã‚„$c_2$ãŒé€†å…ƒã‚’æŒã¤ã“ã¨ã‚’è¨¼æ˜Žã™ã‚‹ãŸã‚ã«ä¸Šã®å‰ææ¡ä»¶ãŒã‚ã‚Šã¾ã™ã€‚ã¨ã„ã†ã®ã‚‚ã€é€†å…ƒã¯æ‹¡å¼µãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‚’ç”¨ã„ã¦æ±‚ã‚ã‚‹ã®ã§ã™ãŒã€$\gcd$ãŒ1ä»¥å¤–ã«ãªã‚‹ã¨é€†å…ƒãŒæ±‚ã¾ã‚Šã¾ã›ã‚“ã€‚

```python:solve.py
from math import gcd
N = 8208175638972200577186038102634114258848486365767463332763957381946985480397227219800325703361508208728778216773973313756762762324416016301819271949512427
c3 = 510199524103978915755062119293765889950938959100085136114101960072728304594090942964306874023123457091885387418124063977610496306587745044542739034336862
c65537 = 4673531855283872496727093452348048121242854682829577660566947295656149440028839210065857595110277181842297946378296819272562912619683355333762343087859186

# c3 ^ 21845 = c65535
# c2 * c65535 = c65537 => c2 = c65537 * inv(c65535)
# m = c1 = c3 * inv(c2)

def extgcd(a, b):
    if b:
        d, y, x = extgcd(b, a % b)
        y -= (a // b)*x
        return d, x, y
    return a, 1, 0

def inv(x):
    assert gcd(x, N) == 1
    _, res, _ = extgcd(x, N)
    return (res + N) % N

c65535 = pow(c3, 65537 // 3, N)
c2 = (c65537 * inv(c65535)) % N
m = (c3 * inv(c2)) % N
print(m.to_bytes(96, "big"))
```
