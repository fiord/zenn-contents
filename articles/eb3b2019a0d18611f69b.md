---
title: "Ã¥ngstromCTF 2021 - Follow the Currents"
emoji: "ðŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CTF", "Crypto", "Easy"]
published: true
---

### å•é¡Œæ¦‚è¦

> go with the [flow...](https://files.actf.co/2ac01144ffa8ce3f4be4837e4e20a6a41b7986160b651d8197e8aba3fe84cc6d/enc) [Source](https://files.actf.co/20e9f50fe5315cb04cf2ba3662e90f433c42a8f75783c0a48dad730ebf87847f/source.py)

```python
import os
import zlib
def keystream():
	key = os.urandom(2)
	index = 0
	while 1:
		index+=1
		if index >= len(key):
			key += zlib.crc32(key).to_bytes(4,'big')
		yield key[index]
ciphertext = []
with open("plain","rb") as f:
	plain = f.read()
	assert b"actf{" in plain
	k = keystream()
	for i in plain:
		ciphertext.append(i ^ next(k))
with open("enc","wb") as g:
	g.write(bytes(ciphertext))
```

`zlib.crc32`ã¨ã„ã†ã‚„ã‚„èžããªã‚Œãªã„ã‚‚ã®ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

### è§£èª¬

å•é¡Œç‚¹ã¯`keystream`ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹`key`ã®åˆæœŸåŒ–ãŒ2byteã—ã‹ãªã„ã¨ã„ã†ç‚¹ã§ã™ã€‚ã“ã‚Œã¯å…¨æŽ¢ç´¢ãŒå®¹æ˜“ãªæ•°å€¤ã§ã™ã€‚

ã¾ãŸã€æš—å·åŒ–ã®ä½œæ¥­ã§XORã‚’ç”¨ã„ã¦ã„ã‚‹ã®ã§ã€ä¸€ç•ªæœ€åˆã®éµã•ãˆåˆ†ã‹ã‚Œã°å¾©å…ƒãŒå¯èƒ½ã§ã™ã€‚ã¨ã„ã†ã“ã¨ã§éµã‚’å…¨æŽ¢ç´¢ã—ã¦ãã‚Œãžã‚Œã®å ´åˆã§å¾©å·ãŒå‡ºæ¥ã‚‹ã‹è©¦ã—ã¾ã™ã€‚

```python:solve.py
import zlib

def keystream(key):
    index = 0
    while 1:
        index += 1
        if index >= len(key):
            key += zlib.crc32(key).to_bytes(4, 'big')
        yield key[index]

f = open("enc", "rb")
cipher = f.read()
for key in range(256 ** 2):
    keys = key.to_bytes(2, "big")
    k = keystream(keys)
    plain = []
    for i in cipher:
        plain.append((i ^ next(k)).to_bytes(1, "big"))
    plain = b"".join(plain)
    if b"actf{" in plain:
        print(plain)
```