---
title: "Ã¥ngstromCTF 2021 - Substitution"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CTF", "Crypto", "Med"]
published: true
---

### å•é¡Œæ¦‚è¦
> [Source](https://files.actf.co/3c66d046b7d644f65c4e4bbb0c7aa4c4420ef1b6fda684e1b00c261ccf6472be/chall.py)
> 
> `nc crypto.2021.chall.actf.co 21601`

```python:chall.py
#!/usr/bin/python

from functools import reduce

with open("flag", "r") as f:
    key = [ord(x) for x in f.read().strip()]



def substitute(value):
    return (reduce(lambda x, y: x*value+y, key))%691



print("Enter a number and it will be returned with our super secret synthetic substitution technique")
while True:
    try:
        value = input("> ")
        if value == 'quit':
            quit()
        value = int(value)
        enc = substitute(value)
        print(">> ", end="")
        print(enc)
    except ValueError:
        print("Invalid input. ")
```

å…¥åŠ›ã¨ã—ã¦ä¸ãˆãŸæ•´æ•°$a$ã«å¯¾ã—ã¦ã€

$a^{n-1}k_{n-1}+a^{n-2}k_{n-2}+\cdots+a^2k_2+ak_1+k_0 (\mod 691)$

ã‚’ãã‚Œã‚‹ã®ã§è§£ã„ã¦ã­ã€ã¨ã„ã†å•é¡Œã§ã™ã€‚

### è§£èª¬
$a=0,1,\cdots,690$ã¾ã§å…¨éƒ¨å–ã‚Œã‚‹ã®ã§å–ã£ã¡ã‚ƒã„ã¾ã—ã‚‡ã†ã€‚ãã®ä¸Šã§ã€ãã‚Œãã‚Œã®è¨ˆç®—çµæœã‹ã‚‰ç­”ãˆã‚’æ±‚ã‚ã¾ã™ãŒã€é€£ç«‹ã™ã‚Œã°ç†è«–çš„ã«ã¯691æ–‡å­—åˆ†ã¾ã§ã¯è§£ã‘ãã†ã§ã™ã€‚sageã«ãŠé¡˜ã„ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```python:collect.py
# crypto.2021.chall.actf.co 21601
from pwn import *

r = remote("crypto.2021.chall.actf.co", 21601)

res = []

for i in range(691):
    r.recvuntil(b"> ")
    r.sendline(str(i))
    s = r.recvline().decode()
    v = int(s.split(" ")[1])
    print(v)
    res.append((i, v))

with open("solve.py", "w") as f:
    f.write("output = ")
    f.write(str(res))
```

```python:solve.sage
output = [(0, 125), (1, 492), ...]

F =GF(691)
R = F['x']
res = list(R.lagrange_polynomial(output))[::-1]
print(res)

flag = ""
for a in res:
  flag += chr(a)
print(flag)
```