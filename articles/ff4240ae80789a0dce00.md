---
title: "kurenaif Valentine Problems - p_p_rsa"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["CTF", "Crypto", "Easy"]
published: true
---

kurenaifã•ã‚“ãŒCryptoã®å•é¡Œã‚’ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã—ã¦ãã‚Œã¾ã—ãŸã€‚ã¡ã‚‡ã£ã¨å¿™ã—ã‹ã£ãŸã®ã§ä»Šã‹ã‚‰è§£ãã¾ã™ã€‚ä¸€å¿œæ—¢ã«å…¬å¼writeupãŒå‡ºã¦ã„ã‚‹ã¯ãšã§ã™ã®ã§ã€ãã¡ã‚‰ã‚’è¦‹ãŸæ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„èª¬ã‚‚ã€‚

## å•é¡Œæ¦‚è¦
[å•é¡Œãƒªãƒ³ã‚¯](https://github.com/kurenaif/kurenaif_valentine_problems/tree/main/p_p_rsa)

```python:problem.py
from Crypto.Util.number import *
from flag import *
import secrets

m = bytes_to_long(flag)

p = getPrime(256)
q = p # Oops!
N = p*q
e = 65537
print("e =", e)
print("N =", N)
print("c =", pow(m, e, N))
```

ã‚³ãƒ¡ãƒ³ãƒˆã®å†…å®¹ã‹ã‚‰ã‚‚ã€æ™®é€šã®RSAãªãŒã‚‰ã‚‚$p=q$ã¨ã„ã†ãƒˆãƒ³ãƒ‡ãƒ¢åˆ¶ç´„ãŒèª²ã›ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

## è§£èª¬
### RSAã£ã¦ãã‚‚ãã‚‚ã©ã‚“ãªã‚„ã¤ã ã£ã‘ï¼Ÿ
æœ¬æ¥ã®RSAãŒã©ã®ã‚ˆã†ã«å‹•ä½œã—ã¦ã„ã‚‹ã‹ã‚’ã¾ãšã¯å¾©ç¿’ã—ã¾ã—ã‚‡ã†ã€‚

- å¤§ããªç´ æ•°$p,q$ã‚’ç”¨æ„ã—ã€$N=p\times q$ã¨ã™ã‚‹ã€‚ã“ã®æ™‚ç‚¹ã§ã®ã€Œ$N$ã‹ã‚‰$p,q$ã‚’æ±‚ã‚ã‚‹ã®ãŒé›£ã—ã„ã€ã¨ã„ã†ã®ãŒRSAã®å¼·ã•ã§ã™ã€‚
- æš—å·åŒ–ã™ã‚‹éš›ã«ã¯$c=m^e ({\rm mod} N)$ã¨ã™ã‚‹ã€‚$e$ã¯æ¡ä»¶[^1]ãŒã‚ã‚‹ã®ã§ã™ãŒã€é©å½“ãªæ•°ã¨ã—ã¦ã‚ˆã65,535ãŒé¸ã°ã‚Œã¾ã™ã€‚
- å¾©å·åŒ–ã®éš›ã«ã¯ã‚ªã‚¤ãƒ©ãƒ¼ã®å°å®šç†ã‚’æ´»ç”¨ã—ã¾ã™ã€‚

> æ¡ä»¶ã¯å‰²æ„›ã—ã¾ã™ãŒã€$\phi(N)$ã‚’$N$ä»¥ä¸‹ã®$N$ã‚’å‰²ã‚Šåˆ‡ã‚‰ãªã„è‡ªç„¶æ•°ã®å€‹æ•°ï¼ˆã‚ªã‚¤ãƒ©ãƒ¼é–¢æ•°ï¼‰ã¨ã—ãŸã¨ãã€$x^{\phi(N)}\equiv 1({\rm mod} N)$

- $ed\equiv 1\left({\rm mod}\phi(N)\right)$ã¨ãªã‚‹$d$ã¯æ‹¡å¼µãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã‹ã‚‰æ±‚ã‚ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ã“ã®æ™‚ã€

- ã“ã®$d$ãŒåˆ†ã‹ã‚‹ã¨ã€$m \equiv c^d({\rm mod}N)$ã§å¾©å·ãŒå¯èƒ½ã§ã™ã€‚ã¨ã„ã†ã®ã‚‚ã€$m \equiv c^d \equiv (m^e)^d \equiv m^{ed} = m^{k\phi(N) + 1} ({\rm mod} N)$ãŒæˆã‚Šç«‹ã¡ã€å…ˆã»ã©ã®ã‚ªã‚¤ãƒ©ãƒ¼ã®å°å®šç†ã‹ã‚‰$m^{\phi(N)}\equiv 1({\rm mod}N)$ãŒæˆç«‹ã™ã‚‹ã‹ã‚‰ã§ã™ã€‚

ã¾ãŸã€$p$ã€$q$ã¯ç•°ãªã‚‹ç´ æ•°ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€$\phi(N)=(p-1)(q-1)$ã¨ã„ã†ã“ã¨ãŒåºƒãçŸ¥ã‚‰ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã‚’ç”¨ã„ã¦è¨ˆç®—ã™ã‚‹ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚

### $p=q$ã ã¨ä½•ãŒèµ·ã“ã‚‹ã‹
ä»Šå›ã®å•é¡Œã®$p=q$ã®å ´åˆã§ã™ãŒã€$p=q=N^{0.5}$ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰$p,q$ã‚’æ±‚ã‚ã‚‹ã“ã¨ãŒã¾ãšå¯èƒ½ã§ã™ã€‚ãã“ã‹ã‚‰$\phi(N)$ã‚‚æ±‚ã¾ã£ã¦ã—ã¾ã„ã€çµæœçš„ã«$d$ãŒè¨ˆç®—å‡ºæ¥ã¦å¾©å·å‡ºæ¥ã¦ã—ã¾ã„ã¾ã™ã€‚

æ³¨æ„ã—ãªãã¦ã¯ãªã‚‰ãªã„ç‚¹ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚
- å…ˆç¨‹èª¬æ˜ã—ãŸ$\phi(N)=(p-1)(q-1)$ã®è©±ã€‚ä»Šå›ã¯$p=q$ã§$p,q$ã¯ç´ æ•°ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€$N$ã‚’å‰²ã‚Šåˆ‡ã‚‹æ•°ã¯$N-p$å€‹ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚ªã‚¤ãƒ©ãƒ¼é–¢æ•°ã‚’ã“ã‚Œã«ç½®ãæ›ãˆã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- Pythonã§sqrtã‚’ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã¨floatã§è¨ˆç®—ã•ã‚Œã‚‹ã®ã§æœ‰åŠ¹æ•°å­—ãŒå…¨ãè¶³ã‚‰ãªã„ã¨æ€ã„ã¾ã™ã€‚åƒ•ã¯2åˆ†æ¢ç´¢ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€ã‚‚ã—ã‹ã—ãŸã‚‰intã®ã¾ã¾sqrtã‚’è¨ˆç®—ã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚ã‚‹ã‹ã‚‚ã§ã™ã­ã€‚

```python:solve.py
e = 65537
N = 7504521114311153672308826977564891107288058227100173341193360340321176562970983694756086045753375611733443716948010092176135133045533366956059169702726409
c = 3120246791506259955679234385495683489853187127801200033777823093969698684663885288175101358075188702658492281935014546035799989917015048182861857825663454

left = 0
right = N
for _ in range(512):
    mid = (left + right) // 2
    if mid * mid > N:
        right = mid
    else:
        left = mid
assert left * left == N
p = q = left

def extgcd(a, b):
    if b:
        d, y, x = extgcd(b, a % b)
        y -= (a // b)*x
        return d, x, y
    return a, 1, 0

# æ³¨æ„
g, d, _ = extgcd(e, N - p)
assert g == 1
assert e * d % (N - p) == 1

assert pow(pow(2, e, N), d, N) == 2
m = pow(c, d, N)
print(m.to_bytes(32, 'big'))
```
[^1]: æ¡ä»¶ã¯ã€Œ$\phi(N)$ã¨äº’ã„ã«ç´ ã§ã‚ã‚‹ã“ã¨ã€ã€Œå°ã•ã™ããšã€ã‹ã¤å¤§ãã™ããªã„ã“ã¨ã€ã§ã™ã€‚å‰è€…ã¯RSAã®åŸç†çš„ã«å¿…é ˆã€å¾Œè€…ã¯è„†å¼±æ€§ã«ãªã‚‹ãŸã‚å¿…è¦ã§ã™ã€‚
